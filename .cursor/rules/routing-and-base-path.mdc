---
alwaysApply: true
---

# Routing and Base Path Configuration

## Base Path Setup

**CRITICAL:** This application uses a base path configuration that affects all routing.

### Current Configuration

- **Base Path:** `/checkout`
- **Configuration Location:** `next.config.js`
- **Environment Variable:** `NEXT_PUBLIC_BASE_PATH` (defaults to `/checkout`)

### Why This Matters

All routes are automatically prefixed with the base path. This affects:

- Page routes
- API routes
- Static assets
- Redirects and rewrites
- Links and navigation
- External integrations

### Examples

**URLs:**

- Homepage: `https://www.varsitytutors.com/checkout`
- Checkout: `https://www.varsitytutors.com/checkout`
- API: `https://www.varsitytutors.com/checkout/api/...`

**Local Development:**

- Homepage: `http://localhost:3000/checkout`

## Rules for AI Assistants

### ALWAYS Consider Base Path When:

1. **Creating new routes or pages**
   - Next.js handles this automatically via `basePath` config
   - No need to manually add base path to file structure

2. **Generating absolute URLs**

   ```typescript
   // ✅ Good - Use environment variable
   const baseUrl = `${process.env.NEXT_PUBLIC_HOST}${process.env.NEXT_PUBLIC_BASE_PATH}`;
   const checkoutUrl = `${baseUrl}/checkout`;

   // ❌ Bad - Hardcoded
   const checkoutUrl = 'https://www.varsitytutors.com/checkout';
   ```

3. **Creating redirects or rewrites in next.config.js**

   ```javascript
   // ✅ Good - Use BASE_PATH constant
   {
     source: '/old-path',
     destination: `${BASE_PATH}/new-path`,
     permanent: true
   }
   ```

4. **Configuring external integrations**
   - OAuth callbacks
   - Webhook endpoints
   - Third-party redirects
   - All must include the base path

5. **Writing documentation**
   - Always mention the base path in setup instructions
   - Include full URLs with base path in examples

6. **Adding analytics or tracking**
   - Page names should exclude base path
   - URLs in analytics should be full paths for proper tracking

### DON'T:

1. **Hardcode the base path anywhere**
   - Always use `process.env.NEXT_PUBLIC_BASE_PATH`
   - Or use the `BASE_PATH` constant from `next.config.js`

2. **Add base path to file structure**

   ```
   ❌ Bad: src/app/checkout/page.tsx
   ✅ Good: src/app/page.tsx (Next.js handles the prefix)
   ```

3. **Forget about the base path in API routes**

   ```typescript
   // ✅ Good
   const response = await fetch(`${process.env.NEXT_PUBLIC_BASE_PATH}/api/checkout`);

   // ❌ Bad
   const response = await fetch('/api/checkout');
   ```

## Related Files

- `next.config.js` - Base path configuration
- `netlify.toml` - Environment variables per context
- `README.md` - Documentation
- `.env.example` - Environment variable template (blocked by .gitignore)

## Testing Base Path

When testing locally:

1. Set `NEXT_PUBLIC_BASE_PATH=/checkout` in `.env.local`
2. Access app at `http://localhost:3000/checkout`
3. Verify all links include base path
4. Check browser network tab for asset paths

## Questions?

If unsure whether something needs base path consideration:

- **Internal Next.js routes:** Automatically handled
- **External URLs:** Must manually include base path
- **API calls from client:** Must include base path
- **When in doubt:** Include it and verify in browser
